# BotKit
`BotKit` — Telegram‑бот для личного учёта лекарств и совместного доступа к "аптечкам".

**Кратко**: храните лекарства в аптечках, добавляйте заметки и сроки годности, делитесь доступом к аптечке с другими пользователями, удаляйте аптечки в корзину и восстанавливайте при необходимости.

**Стек**: Python, aiogram, SQLAlchemy (async), PostgreSQL (asyncpg), Alembic, Redis (опционально).

**Содержание README**
- Клонирование и установка
- Переменные окружения
- Миграции базы
- Запуск бота
- Структура проекта
- Основные команды бота
- Разработка

## Клонирование и установка

```powershell
git clone <repo-url>
cd BotKit
python -m venv .venv
. .venv\Scripts\Activate.ps1
pip install -r requirements.txt
```

## Переменные окружения

Скопируйте пример `.env` (или создайте свой) и заполните значения:

```text
BOT_TOKEN=ваш_токен_бота
DATABASE_URL=postgresql+asyncpg://user:password@host:port/dbname
REDIS_URL=redis://localhost:6379/0   # необязательно
```

Файл `.env` используется библиотекой `python-dotenv`/`environs` для конфигурации.

## Миграции базы данных

Проект использует `alembic`. Примените миграции перед запуском:

```powershell
alembic upgrade head
```

Создать новую миграцию (при изменениях моделей):

```powershell
alembic revision --autogenerate -m "Описание изменений"
alembic upgrade head
```

## Запуск бота

После настройки переменных окружения и миграций запустите:

```powershell
python main.py
```

Или через `docker-compose` (если настроено):

```powershell
docker-compose up --build
```

## Структура проекта (кратко)

- `main.py` — инициализация бота, регистрация роутеров и запуск.
- `app/handlers/` — обработчики Telegram команд и callback'ов (например `app/handlers/medicine/kits.py`).
- `app/keyboard/` — генерация inline-клавиатур.
- `app/database/` — конфигурация БД и модели SQLAlchemy (`models/medicine.py`, `models/users.py`).
- `app/repositoryes/` — классы-репозитории для CRUD операций.
- `app/middleware/` — middleware для DB/Redis/пользовательских данных.
- `app/lexicon/` — тексты и локализация (команды и подсказки).
- `migrations/` — alembic миграции.
- `requirements.txt` — зависимости проекта.

## Основные команды и поведение бота

- `/start` — регистрация/приветствие.
- `/help` — краткий список команд.
- `/upload` — добавить лекарство: выбор аптечки → ввод данных лекарства.
- `/my_kits` — показать ваши аптечки. Отсюда доступны:
	- удаление конкретной аптечки (пометка `deleted=True`),
	- **Корзина аптечек** — показать удалённые аптечки (`deleted=True`), и восстановить их (снятие флага `deleted`).
	- отмена действий.
- `/share` — отправить запрос на шаринг аптечки другому пользователю.
- `/update`, `/del`, `/find`, `/expired` и др. — обновление, удаление и поиск лекарств.

Тексты команд и сообщений хранятся в `app/lexicon/lexicon.py`.

## Как реализовано восстановление аптечек

Репозиторий `MedicineKitRepository` содержит метод `get_all(...)`, который поддерживает фильтр `deleted`.
Для пользователя доступен `get_by_user(user_id, deleted=None)`. Корзина формируется вызовом `get_by_user(user_id, deleted=True)`.
Восстановление выполняется через `update(kit_id, deleted=False)`.

## Разработка и отладка

- Запуск в dev режиме: убедитесь, что `.env` настроен.
- Логирование настраивается в `main.py` — включите уровень `DEBUG` при необходимости.
- Тестовый файл: `test.py` — содержит быстрые проверки (проверьте и настроьте окружение перед запуском).

## Полезные команды для администратора

- Просмотреть зависимости: `pip freeze` / `pip install -r requirements.txt`.
- Применить миграции: `alembic upgrade head`.

## Вопросы и доработки

Если нужно — могу дополнить README примерами `.env`, инструкцией по Docker, CI/CD или подробным описанием роутеров/репозиториев.

---

Финиш: обновлён `README.md` с описанием структуры и функционала бота.

